---
title: "imputation and data cleanup"
author: "Semyon Toybis"
date: "2024-11-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(caret)
library(tidyverse)
library(VIM)
```

```{r}
stu_data_raw <- read_excel('StudentData.xlsx',col_names = T)
stu_data_raw <- as.data.frame(stu_data_raw)
head(stu_data_raw)

```

```{r}
stu_eval_raw <- read_excel('StudentEvaluation.xlsx',col_names = T)
stu_eval_raw <- as.data.frame(stu_eval_raw)
head(stu_eval_raw)
```

```{r}
str(stu_data_raw)
```

```{r}
colSums(is.na(stu_data_raw))
```

## Imputation

First, we sort the columns in ascending order by number of NAs in each column. This is because KNN goes column by column and relies on imputed values in prior columns to impute values in the current column - if the first column has many imputed values, the function will be working off more imputed values than it would otherwise.

```{r}
vars_by_NAs <- stu_data_raw |> is.na() |>
  colSums() |> sort(decreasing = F) |> names()
```

```{r}
stu_data_imputed <- stu_data_raw |> select(all_of(vars_by_NAs)) |> kNN(k = 5, imp_var = F)
```

Below, we compare the distribution of the PH variable in the original data set and in the imputed data set:

```{r}
hist(stu_data_raw$PH)

```

```{r}
hist(stu_data_imputed$PH)
```

## Near zero variance

Next, we re-arrange the columns so that PH, the target variable, is first.

```{r}
stu_data_imputed <- stu_data_imputed %>%
  select('PH', everything())
```

Next, we check to see if any of the predictors have near zero variance:

```{r}
nearZeroVar(stu_data_imputed)
```

The below column has near zero variance:

```{r}
colnames(stu_data_imputed)[nearZeroVar(stu_data_imputed)]
```

The full output can be seen below:

```{r}
nearZeroVar(stu_data_imputed, saveMetrics = T)
```
